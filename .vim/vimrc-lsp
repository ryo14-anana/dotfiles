" Python
if executable('pyls')
  augroup LspPython
    autocmd!
    autocmd User lsp_setup call lsp#register_server({
      \ 'name': 'pyls',
      \ 'cmd': {server_info->['pyls']},
      \ 'whitelist': ['python'],
      \ })
    autocmd FileType python setlocal omnifunc=lsp#complete
  augroup END
endif

" Ruby
if executable('solargraph')
  augroup LspRuby
    autocmd!
    autocmd User lsp_setup call lsp#register_server({
      \ 'name': 'solargraph',
      \ 'cmd': {server_info->[&shell, &shellcmdflag, 'solargraph stdio']},
      \ 'initialization_options': {"diagnostics": "true"},
      \ 'whitelist': ['ruby'],
      \ })
    autocmd FileType ruby setlocal omnifunc=lsp#complete
  augroup END
endif

" Go
" if executable('go-langserver')
"   augroup LspGo
"     autocmd!
"     autocmd User lsp_setup call lsp#register_server({
"           \ 'name': 'go-langserver',
"           \ 'cmd': {server_info->['go-langserver', '-gocodecompletion']},
"           \ 'whitelist': ['go'],
"           \ })
"     autocmd BufWritePre *.go LspDocumentFormatSync
"     autocmd FileType go setlocal omnifunc=lsp#complete
"   augroup END
" endif

if executable('gopls')
  augroup LspGo
    autocmd!
    autocmd User lsp_setup call lsp#register_server({
          \ 'name': 'gopls',
          \ 'cmd': {server_info->['gopls', '-mode', 'stdio']},
          \ 'whitelist': ['go'],
          \ })
    autocmd BufWritePre *.go LspDocumentFormatSync
    autocmd FileType go setlocal omnifunc=lsp#complete
  augroup END
endif
